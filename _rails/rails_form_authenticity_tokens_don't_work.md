---
title: rails5 form authenticity_tokens don't work
labels: actionpack, attached PR
layout: issue
---

This will cause problems for automation tools like mechanize.

Reproduction instructions: view source on any page that uses `form_for`.  Any edit page generated by scaffolding will do.  What you will see will be something like:

```
<!DOCTYPE html>
<html>
  <head>
    <title>Demo</title>
    <meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="R/+8o7qCIsdpxYv0X/fxuZg8Tq5At6st3wmNM5vHgr7qdo29rBsTIE4mtxOFbGYTfcXTTI+Da88GirnPQUDkKQ==" />
    <meta name="action-cable-url" content="/cable" />

    <link rel="stylesheet" media="all" href="/assets/companies.self-e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css?body=1" data-turbolinks-track="true" />
<link rel="stylesheet" media="all" href="/assets/scaffolds.self-13e017ed781aee5641573fc553cae1177b6eb2ae02ee29ba9a3927350998c06d.css?body=1" data-turbolinks-track="true" />
<link rel="stylesheet" media="all" href="/assets/application.self-af04b226fd7202dfc532ce7aedb95a0128277937e90d3b3a3d35e1cce9e16886.css?body=1" data-turbolinks-track="true" />
    <script src="/assets/jquery.self-c64a74367bda6ef8b860f19e74df08927ca99d2be2ac934e9e92d5fd361e0da4.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/jquery_ujs.self-d602bdfe68ffc63b9f9cc512872aa3cfff046228a0a36e90dd476e8ef54c1b09.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/turbolinks.self-088c452541bc2cb3c0ff28ae33e5c6516d309f7e097363b1d7d062f9cbe5a947.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/action_cable.self-8fc7cfd5b796d0299c89a57dbf5b046051f42ce410f160fd7f1e677c8dc07def.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/action_cable/connection.self-5625494ff511c0f78cd0746ef7e14909f3d517ceb45f989511e4b216c1862593.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/action_cable/connection_monitor.self-ca8bfd8bf7c622d03bf8314cbde2cf77e5a7732c8082e2fc50828a14175f6b53.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/action_cable/subscriptions.self-156d38d6efaf3f6139b95c7fc9fcfc44a62d77f2c13108a2d58c33b0017eec10.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/action_cable/subscription.self-63bb8fcaf3e18e3bb4b849c831819921afe52d3e48e77f3c0d2d50fdf43a9b0c.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/action_cable/consumer.self-d0a6518de32602abb57c66be88b1fd0445527abfb6d8fad3a0be0c59eb6b7fd1.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/cable.self-877aef30ae1b040ab8a3aba4e3e309a11d7f2612f44dde450b5c157aa5f95c05.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/companies.self-877aef30ae1b040ab8a3aba4e3e309a11d7f2612f44dde450b5c157aa5f95c05.js?body=1" data-turbolinks-track="true"></script>
<script src="/assets/application.self-b89234cf2659d7fedea75bca0b8d231ad7dfc2f3f57fcbaf5f44ed9dc384137b.js?body=1" data-turbolinks-track="true"></script>
  </head>

  <body>
    <h1>Editing Company</h1>

<form class="edit_company" id="edit_company_2" action="/companies/2" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><input type="hidden" name="authenticity_token" value="1HxW3jw7tINiIbD8X25t15MukXOFV4g6sXD666f1oCt2BqGlZ1xGPHZ3w9NHuoISBFCynd63mETK8MHETZCTYw==" />

  <div class="field">
    <label for="company_name">Name</label>
    <input type="text" value="asdf" name="company[name]" id="company_name" />
  </div>

  <div class="actions">
    <input type="submit" name="commit" value="Update company" data-disable-with="Update company" />
  </div>
</form>

<a href="/companies/2">Show</a> |
<a href="/companies">Back</a>

  </body>
</html>
```

The important lines are:

```
<meta name="csrf-token" content="R/+8o7qCIsdpxYv0X/fxuZg8Tq5At6st3wmNM5vHgr7qdo29rBsTIE4mtxOFbGYTfcXTTI+Da88GirnPQUDkKQ==" />
```

and

```
<input type="hidden" name="authenticity_token" value="1HxW3jw7tINiIbD8X25t15MukXOFV4g6sXD666f1oCt2BqGlZ1xGPHZ3w9NHuoISBFCynd63mETK8MHETZCTYw==" />
```

Note that the values don't match.  They do with Rails 4.x releases.

